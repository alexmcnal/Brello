<h1><%= @board.name %></h1>
<h3><%= @board.description %></h3>
<%= link_to "Edit Board", edit_project_board_path(@project, @board) %>

<div class="toolbar">
  <%= link_to "Add Card", new_project_board_card_path(@project, @board), class: "button__primary", data: { controller: "dialog", action: "dialog#open" }%>
  <%= link_to "Add Column", new_project_board_board_column_path(@project, @board), class: "button__primary" %>
</div>

<!-- Hidden form for updating cards -->
<%= form_for :card, url: '/cards/:id', method: :patch,
              data: { controller: "board--card-move", action: "board--card-move#handleMoveCard" }, class: 'hidden' do |form| %>
  <%= form.hidden_field :column_id, data: { board__card_move_target: 'columnIdInput' } %>
  <%= form.hidden_field :position, data: { board__card_move_target: 'positionInput' } %>
  <%= hidden_field_tag :board_id, @board.id %>
  <%= form.submit "Update Card" %>
<% end %> 

<%= turbo_stream_from @board.project %>

<div
  class="board-wrapper"
  data-controller="column-drag board"
  data-project-id="<%= @project.id %>"
  data-board-id="<%= @board.id %>"
>
  <div
    class="board"
    data-controller="card-drag"
  >

    <!-- Hidden form for updating columns -->
    <%= form_for :board_column, url: '/board_columns/id', method: :patch,
                 data: { turbo: false }, id: 'columns-form', class: 'hidden' do |form| %>
      <%= form.text_field :position %>
      <%= hidden_field_tag :board_id, @board.id %>
      <%= form.submit "Update Column" %>
    <% end %>

    <% @board_columns.order(:position).each do |board_column| %>
      <% column = board_column.column %>
      <div class="board__column" data-column-id="<%= column.id %>" data-board-column-id="<%= board_column.id %>">
        <div class="board__column-header drag-handle drag-icon">
          <h2 class="board__column-title"><%= column.name.titleize %></h2>
        </div>
        <%= turbo_frame_tag dom_id(column, :board), src: project_board_column_path(@project, @board, column), class: 'content' do %>
          Loading...
        <% end %>
      </div>
    <% end %>
  </div>
</div>
